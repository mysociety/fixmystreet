[% moderating = c.user && c.user.has_permission_to('moderate', problem.bodies_str) %]

[% IF moderating %]
[%# TODO: extract stylesheet! %]
<style>
    .moderate-edit label,
    .moderate-edit input {
        display: inline-block;
    }

    .moderate-edit { display: none }
    .moderate-edit :disabled {
        background: #ddd;
    }
</style>
[% END %]

<div class="problem-header cf" problem-id="[% problem.id %]">
  [% IF moderating %]
    [% original = problem.moderation_original_data %]
    <form method="post" action="/moderate/report/[% problem.id %]">
        <input type="button" class="moderate moderate-display" value="moderate">
        <div class="moderate-edit">
            <label for="problem_show_name">Show name publicly?</label>
            <input type="checkbox" name="problem_show_name" [% problem.anonymous ? '' : 'checked' %]>
            [% IF problem.photo or original.photo %]
                <label for="problem_show_photo">Show Photo?</label>
                <input type="checkbox" name="problem_show_photo" [% problem.photo ? 'checked' : '' %]>
            [% END %]
        </div>
  [% END %]
    <h1 class="moderate-display">[% problem.title | html %]</h1>
    [% IF moderating %]
    <div class="moderate-edit">
        [% IF problem.title != original.title %]
        <label for="problem_revert_title">Revert to original title</label>
        <input type="checkbox" name="problem_revert_title" class="revert-title">
        [% END %]
    <h1><input type="text" name="problem_title" value="[% problem.title | html %]"></h1>
    </div>
    [% END %]

    <p><em>
    [% problem.meta_line(c) | html %]
    [%- IF !problem.used_map AND c.cobrand.moniker != 'emptyhomes' %]; <strong>[% loc('there is no pin shown as the user did not use the map') %]</strong>[% END %]
    [% IF problem.bodies_str %]
        [% INCLUDE 'report/_council_sent_info.html' %]
    [% ELSE %]
        <br><small>[% loc('Not reported to council') %]</small>
    [% END %]
    [% mlog = problem.latest_moderation_log_entry(); IF mlog %]
        <br /> Moderated by [% mlog.user.from_body.name %] at [% prettify_dt(mlog.whenedited) %]
    [% END %]
    </em></p>
    [% INCLUDE 'report/_support.html' %]

    [% IF c.cobrand.moniker != 'southampton' %]
        [% INCLUDE 'report/photo.html' object=problem %]
    [% END %]

        <div class="moderate-display">
            [% add_links( problem.detail ) | html_para %]
        </div>
        [% IF moderating %]
            <div class="moderate-edit">
            [% IF problem.detail != original.detail %]
            <label for="problem_revert_detail">Revert to original text</label>
            <input type="checkbox" name="problem_revert_detail" class="revert-textarea">
            [% END %]
            <textarea name="problem_detail">[% add_links( problem.detail ) %]</textarea>
            </div>
        [% END %]

    [% IF c.cobrand.moniker == 'southampton' %]
        [% INCLUDE 'report/photo.html' object=problem %]
    [% END %]

  [% IF moderating %]
        <div class="moderate-edit">
            <label for="moderation_reason">Moderation reason:</label>
            <input type="text" name="moderation_reason" placeholder="Describe why you are moderating this">
            <input type="submit" value="submit">
            <input type="button" class="cancel" value="cancel">
        </div>
    </form>
  [% END %]
</div>
