[% IF updates.size %]

[%# We assume internal notes are lowest priority, and thus displayed last.
    All other updates (eg: "I've done this work, here's what you should tell
    the citizen") are displayed first. %]

[%  internal_updates=[];
    other_updates=[];
    FOREACH update IN updates;
        IF update.extra.is_internal_note;
            internal_updates.push(update);
        ELSE;
            other_updates.push(update);
        END;
    END
%]

[% IF other_updates.size %]
    <h2>[% loc('Updates') %]</h2>

    [% FOREACH update IN other_updates -%]
        <div class="admin-note [% 'adminhidden' IF update.state == 'hidden' || update.problem.state == 'hidden' %]" title="[% loc('ID') %]: [% update.id %]">
          <p class="admin-note__text">[% update.text | html %]</p>
          <p class="admin-note__creator">
            <a href="mailto:[% update.user.email %]">[% update.user.name || update.user.email %]</a>
            &middot; [% PROCESS format_date this_date=update.created %] [% update.created.hms %]
          </p>
        </div>
    [% END -%]
[% END %]

[% IF internal_updates.size %]
    <h2>[% loc('Internal notes') %]</h2>

    [% FOREACH update IN internal_updates -%]
        <div class="admin-note admininternal" title="[% loc('ID') %]: [% update.id %]">
          <p class="admin-note__text">[% update.text | html %]</p>
          <p class="admin-note__creator">
            <a href="mailto:[% update.user.email %]">[% update.user.name || update.user.email %]</a>
            &middot; [% PROCESS format_date this_date=update.created %] [% update.created.hms %]
          </p>
        </div>
    [% END -%]

[% END %]

[% END %]
